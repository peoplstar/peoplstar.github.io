---
layout: post
title: KISEC 모의해킹 결과 보고서
subtitle: The Old vesrion of KISEC 보고서
categories: Pentest
tags: [Pentest, Web]
---

**본 내용 및 실습 환경은 KISEC, 케이쉴드 주니어 교육 과정에 있음을 알려드립니다.**


## 목차

1. **개요**
   1. 수행 배경 및 목적
   2. 수행 일정 및 인원
   3. 수행 대상 및 장소
   4. 수행 단계별 방법
   5. 점검 항목
   6. 점검 도구
2. **결과 요약**
   1. 영향도 평가 기준
   2. 총평
   3. 취약점 요약
3. **상세 설명**
   1. 정보 수집
   2. SQL Injection
   3. 파일 다운로드
   4. XSS 취약점
   5. 정보 노출
   6. 

### 1-1. 수행 배경 및 목적

본 모의해킹은 KISEC의 관련된 모든 정보 자산에 대해 취약점을 도출 및 분석하여 대책을 수립하기 위함이다. 해커와 동일한 환경과 조건, Hacking Skill을 가지고 모의 침투에 의해 이루어지며, 발견된 취약점에 대해서는 사전적인 예방을 통한 효과를 발생시키는데 목적이 있습니다.

KISEC(한국정보보호교육센터)은 인재 양성을 위한 수강자 강의를 하는 서비스를 진행하고 있다. KISEC(강의를 하고 있다)에서 가장 큰 위협
개인 정보, 강좌에 대한 정보, 강좌에 대한 결제 시스템(파리미터 조작)로 인한 금전적 피해, 기업 이미지

### 1-2. 수행 일정 및 인원 (작성중)

 일정 | | | | |
:-----: |:------------:| :-----:|:-----------:|:-----:|
8월 8일|8월 9일|8월 10일|8월 11일|8월 12일|
20      |  0010 0000  |   B    |  0100 0010  | 0101 0010|
8월 15일|8월 16일|8월 17일|8월 18일|8월 19일|
10      |  0001 0000  |   D    |  0100 0100  | 0101 0100|

### 1-3. 수행 대상 및 장소

본 모의해킹은 아래 대상을 전달 받았으며, 추후 점검 기준에 의거하여 점검을 시행합니다.

구분| 대상 도메인 | 대상 IP 정보 | 서비스 |
:-----: |:--------:| :-----:|:---------:|
외부 모의해킹| `http://10.200.43.12` |10.200.43.12|강의|

본 모의해킹은 외부 아이피 대역에서 진행하였으며, 수행자의 IP는 담당자에게 전달받은 상태로 진행합니다. 실질적인 서비스를 진행하고 있기에 서비스 거부 공격을 제외한 취약점 진단을 진행한다.

구분| 대상 도메인 | 수행자 IP 정보 | 
:-----: |:--------:| :-----:|
외부 모의해킹 | `http://10.200.43.12` |10.200.43.4|

### 1-4. 수행 단계별 방법

본 모의해킹은 아래 단계별로 정보수집부터 결과 보고서까지 과정을 통해 진행이 됩니다.

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184567195-b96a9bcd-2807-4071-8b18-0426aaa3c16a.jpg" width = 420>
</p>

각 단계별 수행에 대한 간략한 내용은 아래표와 같습니다.
수행 단계 | 설명 |
:-----:|:-----:|
정보 수집|대상에 대한 서버 / 네트워크 / 서비스에 대한 불필요한 서비스 접근 가능성, 외부에서 파악 할 수 있는 정보들을 수집하는 단계|
취약점 수집|각 네트워크 구간별로 적합한 취약점 스캔 도구를 이용하여 발생할 수 있는 취약점에 대한 정보를 수집하는 단계|
침투 단계|취약점 수집 단계를 통해 획득한 정보를 기반으로 수동점검을 통해 내부 시스템까지 침투할 가능성이 있는지 시나리오 기반으로 접근하는 단계|
상세 분석|취약점이 도출되었을 경우에 공격에 의해서 보안 위협이 시스템 및 비지니스 측면에서 어느저옫의 영향을 줄 수 있는지 분석하는 단계|
보고서 작성|도출된 취약점에 대한 총평 / 영향도 / 상세분석 / 보안 가이드가 포험된 보고서를 작성하는 단계|

### 1-5. 점검 항목

점검 항목은 KISA에서 제공하는 **주요정보통신기반시설 기술적 취약점 분석 평가 방법 상세가이드**를 기반으로 진행합니다.

(참고하실 [KISA 링크](https://www.kisa.or.kr/2060204)입니다.)

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/183579387-481d1736-8f9e-42e0-bbed-932407e94f57.jpg" width = 450>
</p>


### 1-6. 점검 도구

본 모의해킹을 수행하면서 사옹된 도구는 아래와 같습니다.

도구 이름| 사이트 | 용도 | 메뉴얼 |
:-----:|:-----:|:-----:|:-----:|
Burp Suite | | | 

## 결과 요약

## 상세 설명

### 정보 수집

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184569715-407dff17-d2c0-428a-ae56-652edaf8d9aa.jpg" width = 320>
</p>

* Network Scanning Tool인 `nmap`을 활용하여 KISEC을 제공하는 서버에 스캔을 시도한 결과로 현재 서버는 Linux 기반으로 버전은 4.15에서 5.6으로 추정된다. 또한 Database인 MySQL을 비롯한 5개의 포트가 열려있는 것을 알 수 있다.

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/183580021-db074e91-a0cf-412a-9651-7cc22643ac74.jpg" width = 420>
</p>

* 대상 웹사이트가 어떤 것인지 식별할 수 있게 도와주는 Web Scanning Tool인 `whatweb` 도구이다. 웹 콘텐츠 관리 시스템(CMS), 블로그 플랫폼, 통계/분석 패키지, 자바 스크립트 라이브러러리, 웹 서버 등을 식별할 수 있다.

플랫폼 종류 |버전||허용 포트|서비스 종류|
:-----:|:-----:|:-----:|:-----:|:-----:|
Apache, mod_ssl | 2.2.22||22|SSH|
PHP | 5.3.25||80|HTTP|
OpenSSL | 1.0.2g||3306|MySQL|
||||5901|VNC-1|
||||6001|x11:1|

### SQL Injection

#### 개념 

* Structured Query Language 의 약어로 데이터 베이스에 접근할 수 있는 데이터 베이스의 하부 언어라고 할 수 있습니다. 그리고 웹 어플리케이션의 경우 사용자의 입력값을 이 SQL 을 통해 데이터 베이스와의 통신을 하게 됩니다. 

* 하지만 SQL 역시 인터프리터 언어의 일종이기 때문에 다른 인터프리터 언어와 같이 사용자가 입력한 데이터를 받은 후 형식에 맞게 변환하여 실행됩니다. 이 때 사용자가 제공하는 데이터와 프로그래머가 작성한 명령어와 뒤섞여 실행되므로 만약 사용자에 의해 예상치 못한 값을 입력 받게 되면 프로그래머가 의도하지 않은 방식으로 웹 어플리케이션이 동작하게 됩니다.

#### 에러 페이지 반환 점검

본 점검은 KISEC 페이지의 입력 값에 대한 에러 페이지 출력에 대한 점검으로 해당 검증이 이루어지지 않는다면 이용중인 데이터베이스 버전뿐만 아니라 이를 활용한 데이터베이스 접근이 가능하게 된다.

첫번째 SQLi 점검 기법으로 **'**(싱글 쿼테이션)을 하나 추가하여 Query문을 비정상적으로 만드는 것이다. 

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184571353-47f09812-253b-46a6-a6e5-63e518d350f2.jpg" width = 420>
</p>

* 해당 URL : http://10.200.43.12/kisec/dataRoom/kisec_lab.html?keyfield=t1.b_title&keyword='

해당 검색란에 **'**(싱글 쿼테이션)을 넣으면 비정상적인 쿼리로 인해 DB 에러 페이지가 노출된다.

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184571599-0705d2e3-d229-4463-9925-9bc152a84556.jpg" width = 380>
</p>

데이터베이스의 주요 정보가 노출되지 않았지만, 이처럼 쿼리자체에 문제가 있다고 노출시키는 것만으로 타 공격자에 의해 무차별적 공격이 이루어질 수 있다.

_위 증상이 발생하는 페이지_

* **커뮤니티**
   * **공지사항** : http://10.200.43.12/kisec/dataRoom/notice.html?keyfield=t1.b_title&keyword='
   * **KISEC Album** : http://10.200.43.12/kisec/dataRoom/kisec_album.html?keyfield=t1.b_title&keyword='
   * **f-NGS Lab** : http://10.200.43.12/kisec/dataRoom/kisec_lab.html?keyfield=t1.b_title&keyword=
   * **수강 후기** : http://10.200.43.12/kisec/dataRoom/after.html?keyfield=t1.b_title&keyword=
   * **공통 인덱스** : 각 게시물 URL **idx** parameter

* **로그인**
   * **모든 입력란** : http://10.200.43.12/kisec/member/join_m_step02.html

#### Blind SQLi

쿼리문을 전송하고 이 쿼리의 참, 거짓 여부를 활용하여 데이터를 얻어내는 점검 방식을 말합니다.

웹 페이지를 여는 URL의 **indx** 부분에
`and 1=1 -- `를 추가하였을 때, 만약 응답 기반의 취약점이 존재한다면 and 이후 문장의 참 / 거짓 여부에 따라 정상 / 에러 페이지가 결정된다.

* **참일 경우**

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184587199-88b3eb47-245a-4945-bbb2-f1d1dc35daf4.jpg" width = 420>
</p>

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184587205-d1ff2014-be09-44fc-ba9a-548d84349b5c.jpg" width = 420>
</p>

* **거짓일 경우**

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184587485-e21ee6e5-56f9-4282-943f-228c3811f773.jpg" width = 420>
</p>

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184587489-6bee916a-8262-4193-8e07-d7be4724a93c.jpg" width = 420>
</p>


#### 모의 침투

Union SQL Injection을 이용한 모의 침투를 실시한다.

```
http://10.200.43.12/kisec/dataRoom/notice_view.html?idx=36&keyfield=&keyword=
http://10.200.43.12/kisec/dataRoom/kisec_lab_view.html?idx=26&keyfield=&keyword=
http://10.200.43.12/kisec/dataRoom/after_view.html?idx=37&keyfield=&keyword=
```

홈 > 커뮤니티 : `KISEC ALBUM`을 제외한 3개의 URL **idx** parameter를 이용한다.

* INFORMATION_SCHEMAS : 데이터베이스의 정보를 담고 있으며 모든 Table과 Column의 정보 역시 포함하고 있습니다.

데이터베이스 종류 | 연결 연산자|
:-----:|:-----:|
TABLES | DB 내의 모든 테이블 정보
COLUMNS | DB 내의 모든 칼럼 정보

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184582642-a751e470-2272-4e3a-863c-1e37ba9216f2.jpg" width = 420>
</p>

```SQL 
' UNION SELECT 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, GROUP_CONCAT(TABLE_NAME SEPARATOR ' '), 17, 18 FROM INFORMATION_SCHEMA.TABLES -- 
```
(주석인 **--** 뒤에 공백 필요)

현재 사용중인 데이터베이스의 모든 테이블 값이 출력되는 것을 알 수 있다.

이 중에서 노출되면 위험하다고 예상되는 부분인 `USER_PRIVILEGES, add_info, admin_mem, hm_admin_tb`가 있다.

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184585396-1778885b-ce25-4759-9a33-610099b94879.jpg" width = 420>
</p>

```SQL
' UNION SELECT 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, GROUP_CONCAT(COLUMNS_NAME SEPARATOR ' '), 17, 18 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = "HM_ADMIN_TB" -- 
```

* hm_admin_tb
   * `idx admin_status admin_type admin_id admin_pass admin_name admin_phone admin_mobile admin_email admin_grade admin_hit admin_cmt reg_date last_date`

이 테이블에는 관리자 계정에 관한 정보가 들어있는 것을 알 수 있다.

**이와 같은 방식으로 원하는 테이블 명과 컬럼 명 및 세부 정보까지 확인할 수 있다.**

kisecadmin, 35c13251030c2a27deb56fa774ad8b07(kisec)

Httrack, discou...로 숨겨진 admin 페이지 찾기.

### File Download

게시판 등에 저장된 자료에 대해 위치 지정에 대한 제한을 부여하지 않아 웹 서버 내의 비공개 자료를 다운로드 받을 수 있는 취약점입니다.

우선 URL 파라미터에 파일 이름 혹은 파일 번호를 할당하여 데이터를 처리하는 동적 방식, 그리고 다음으로 특정 디렉터리에 파일 링크를 걸어 사용자에게 제공하는 정적 방식이 있습니다. 

#### 취약점 점검 및 모의침투

모의 침투는 공격자 측에서 서버 내의 파일 다운로드 취약점을 활용하여 파일의 저장 경로를 알아내고 이를 통해 서버의 DB 관련 주요 파일을 다운로드 합니다.

* 경로 : 홈 > 커뮤니티 > f-NGS Lab
* 링크 : http://10.200.43.12/kisec/dataRoom/kisec_lab_view.html?idx=26&keyfield=&keyword=

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/184592720-9b51cb9d-488d-42e0-b0de-52ab110899f4.jpg" width = 280>
</p>

`test.txt`파일을 다운로드 받을 수 있는 서비스가 존재한다. 해당 파일을 다운로드 받고 이에 대한 패킷을 프록시 도구인 Burp Suite로 가로채서 저장 경로를 확인합니다.

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/183573138-29ed3021-c323-4fc3-8059-59c976a42f7a.jpg" width = 550>
</p>

`test.txt` 파일은 **lab** 라는 경로에 존재함을 확인합니다. 또한 파일
명은 `file_name` 라는 파라미터를, 로컬로 다운로드 될 이름은 `test.txt` 라는 파라미터를 통해 전달 받는 것을 역시 확인하고 이 파라미터를 변조하여 다른 경로의 서버 파일을 다운 받게 됩니다.

* 현재 위치 : `http://10.200.43.12/_core/etc/`
  * `/etc/` 디렉토리는 최상위 디렉토리에 존재한다. **../**를 추가해보면서 `passwd` 파일을 다운로드 시도하면 아래와 같은 결과가 나온다.

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/183574205-423f824e-4045-455c-b109-a2b7b49a8127.jpg" width = 550>
</p>

이렇게 임의의 경로로 변경하여 허용되지 않은 파일을 열람 및 다운로드를 받을 수 있는 취약점이 존재하는 것을 알 수 있다.

### XSS 취약점

**Cross Site Scripting** 의 약어로 악의적인 코드를 웹 컨텐츠로 보내는 공격 방식을 말합니다. URL 혹은 웹사이트 내의 취약한 폼 필드에 스크립트로 짜여진 악의적인 코드를 삽입하여 만약 해당 웹사이트의 사용자가 이 컨텐츠를 실행하게 되면 그 사용자의 컴퓨터에서 스크립트가 실행되고 공격자의 의도대로 동작하게 됩니다. 

**즉 간단히 요약하면 XSS 는 공격자가 입력한 스크립트를 다른 사용자의 컴퓨터 에서 실행 시키는 것 이라고 할 수 있습니다.**

점검 문자열로는 `<script>alert("documnet.cookie");</script>`와 `<iframe src = "url"></iframe>`를 점검 할 것이다.
<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/183585841-133020e6-cfc5-4e04-9566-ea87ae3f091d.jpg" width = 320 alien = 'left'>
</p>

<p align="center">
<img src ="https://user-images.githubusercontent.com/78135526/183585974-8b8cfaa5-ba72-48dd-82df-e90bd1deb96d.jpg" width = 320 alien = 'right'>
</p>

* 취약점 현황
  * 발견 URL
    * `http://10.200.43.12/kisec/mypage/mypage_mtm_list.html`
    * `http://10.200.43.12/kisec/mypage/mypage_coupon_buy_list.html`
  
본문 내용의 스크립트 구문 삽입 시 해당 스크립트가 실행되는 취약점 발견 이로인해 타 사용자 권한 획득 또는 악성서버 유도를 통해 홈페이지를 방문한 사용자가 악성코드가 감염될 가능성이 있다.